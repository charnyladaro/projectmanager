{% extends "base.html" %}
{% block content %}

<h1>Admin Dashboard</h1>

<h2>Add New Project</h2>
<form method="POST" action="{{ url_for('admin_dashboard') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="text" name="project_name" placeholder="Project Name" required>
    <textarea name="project_description" placeholder="Project Description"></textarea>
    <button type="submit" name="add_project">Add Project</button>
</form>

<div style="width: 500px; height: 300px; border:1px solid black;">
<h2>Users</h2>
<ul>
{% for user in users %}
    <li>{{ user.username }} ({{ user.email }})</li>
{% endfor %}
</ul>

</div>

<div style="width: 500px; height: 300px; border:1px solid black; align-items: center;">
<h2>All Projects</h2>
{% for project in projects %}
<div class="project-item" data-project-id="{{ project.id }}">
    <span>{{ project.name }} - {{ project.description }}</span>
    <button class="delete-project" data-project-id="{{ project.id }}">Delete Project</button>
</div>
{% endfor %}

</div>

<div style="width: 500px; height: auto; border:1px solid black; align-items: center;">
<h2>All Tasks</h2>
<ul>
{% for task in tasks %}
    <li>
        <h3>{{ task.title }} - {{ task.status }}</h3>
        <p>{{ task.description }}</p>
        <p>Due date: {{ task.due_date.strftime('%Y-%m-%d') }}</p>
        <p>Time spent: {{ task.formatted_time_spent }}</p>
        <p>Assigned to : <!--LIST ALL USERS THAT ASSIGNED TO THIS TASK---></p>
        {% if task.files %}
        <h4>Uploaded Files:</h4>
        <div class="uploaded-files">
            {% for file in task.files %}
            <div class="uploaded-file">
                {% if file.file_type == 'image' %}
                    <img src="{{ url_for('serve_file', file_id=file.id) }}" alt="Uploaded image" class="uploaded-image">
                {% endif %}
                <a href="{{ url_for('download_file', file_id=file.id) }}">{{ file.filename }}</a>
                <button class="delete-file" data-file-id="{{ file.id }}">Delete File</button>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </li>
{% endfor %}
</ul>
</div>


<h2>Add New Task</h2>
<form method="POST" action="{{ url_for('admin_dashboard') }}" enctype="multipart/form-data">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <select name="project_id" required>
        {% for project in projects %}
        <option value="{{ project.id }}">{{ project.name }}</option>
        {% endfor %}
    </select>
    <input type="text" name="task_title" placeholder="Task Title" required>
    <textarea name="task_description" placeholder="Task Description"></textarea>
    <select name="task_status">
        <option value="To Do">To Do</option>
        <option value="In Progress">In Progress</option>
        <option value="Done">Done</option>
    </select>
    <input type="date" name="due_date" required>
    <input type="file" name="files[]" multiple>
    <input type="submit" name="add_task" value="Add Task">
</form>

{% endblock %}
